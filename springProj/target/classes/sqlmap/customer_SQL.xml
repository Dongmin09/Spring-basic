<?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : xml 파일은 여러개일 수 있으므로
	이를 구별하기 위한 식별 용도로 사용
	  -->
<mapper namespace="customer">
	
	<sql id="where">
		<!-- 통합 검색 -->
	    AND (CUM_ID LIKE '%' || #{keyword} || '%' 
	    OR CUM_NAME LIKE '%' || #{keyword} || '%' 
	    OR CUM_JOB LIKE '%'  || #{keyword} || '%' 
	    OR CUM_LIKE LIKE '%' || #{keyword} || '%' 
	    OR CUM_SKIL LIKE '%' || #{keyword} || '%')
	</sql>



	 <!-- customer 테이블에 insert  -->
 	<insert id="create" parameterType="kr.or.ddit.vo.CustomerVO">
		INSERT INTO CUSTOMER (CUM_ID,CUM_NAME,CUM_JOB,CUM_LIKE,CUM_SKIL) 
		VALUES(#{cumId},#{cumName},#{cumJob},#{cumLike},#{cumSkil})
	</insert> 
	
	<!-- customer list  -->
	<select id="list" resultType="customerVO" parameterType="hashMap">
		WITH T AS(
		SELECT ROW_NUMBER() OVER (ORDER BY CUM_ID ASC) RNUM,
		CUM_ID,CUM_NAME,CUM_JOB,CUM_LIKE,CUM_SKIL
		FROM CUSTOMER 
		WHERE 1 = 1
		<if test="keyword!=null and keyword!=''">
			<include refid="where"></include>
		</if>
		)
		SELECT * FROM T
		WHERE T.RNUM BETWEEN #{currentPage}* #{show} -(#{show}-1) AND #{currentPage} * #{show}
	</select>
	
	<!-- CUSTOMER 테이블의 전체 행 수 구함 -->
	<select id="getTotal" resultType="int" parameterType="hashMap">
		SELECT COUNT(*) FROM CUSTOMER
		WHERE 1 = 1
		<if test="keyword!=null and keyword!=''">
			<include refid="where"></include>
		</if>
	</select>
	
	<!-- 아이디 중복 체크  -->
	<!-- parameterType은 String, hashMap, customerVO  -->
	<select id="chkDup" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM CUSTOMER WHERE CUM_ID = #{cumId}
	
	</select>
</mapper>